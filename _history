{"entries":[{"timestamp":1736949117200,"editorVersion":"7.0.57","changes":[{"type":"edited","filename":"main.blocks","patch":[{"diffs":[[0,"iables><"],[1,"block type=\"pxt-on-start\" x=\"20\" y=\"20\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"K:8{tX4[_b6={i8yzhY4\">找到終點</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"!TvgL[]?w-ivmTrPRiPq\">終點時間</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"LvaO%H8^0ZHA1a`+@QPe\">總標記線數量</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">10</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"{f!}ythzvVcmXeb^C)[X\">基礎速度</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">200</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"2FvlfyBUR@I.?+^t.maK\">kp</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">150</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"QOI+`Dv`3bLK{@(O*3:P\">kd</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">180</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"device_button_event\" x=\"360\" y=\"20\"><field name=\"NAME\">Button.A</field><comment pinned=\"false\" h=\"80\" w=\"160\">按下 A 鍵後開始巡線\nbasic.clearScreen();</comment><statement name=\"HANDLER\"><block type=\"music_playable_play\"><field name=\"playbackMode\">music.PlaybackMode.UntilDone</field><value name=\"toPlay\"><shadow type=\"music_string_playable\"></shadow><block type=\"music_tone_playable\"><value name=\"note\"><shadow type=\"device_note\"><field name=\"name\">988</field></shadow></value><value name=\"duration\"><shadow type=\"device_beat\"><field name=\"fraction\">BeatFraction.Whole</field></shadow></value></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">1000</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"5QwXe*=A.z8P_/:iiXFs\">標記線計數</field><comment pinned=\"false\" h=\"80\" w=\"160\">找到終點 = 0;</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"function_call\"><mutation name=\"巡白線\" functionid=\"wCxxf0@/-x6ktsm6Dwpk\"></mutation><next><block type=\"device_pause\"><comment pinned=\"false\" h=\"80\" w=\"160\">music.play(music.tonePlayable(988, music.beat(BeatFraction.Whole)), music.PlaybackMode.UntilDone);\nbasic.showIcon(IconNames.Square);</comment><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">1000</field></shadow></value></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"884\" y=\"20\"><mutation name=\"設定PID控制器\" functionid=\"MYNFoD,tACwb(%#-_!Lz\"><arg name=\"基礎速度\" id=\"bb042lfh929sybv5jdmvor\" type=\"number\"></arg><arg name=\"kp\" id=\"g26ojmjt5jflw24psjzu\" type=\"number\"></arg><arg name=\"kd\" id=\"r6q6b1big4eitjv0gnlg\" type=\"number\"></arg></mutation><field name=\"function_name\">設定PID控制器</field><comment pinned=\"false\" h=\"80\" w=\"160\">設定PID控制器</comment><value name=\"bb042lfh929sybv5jdmvor\"><block type=\"argument_reporter_number\"><mutation duplicateondrag=\"true\"></mutation><field name=\"VALUE\">基礎速度</field></block></value><value name=\"g26ojmjt5jflw24psjzu\"><block type=\"argument_reporter_number\"><mutation duplicateondrag=\"true\"></mutation><field name=\"VALUE\">kp</field></block></value><value name=\"r6q6b1big4eitjv0gnlg\"><block type=\"argument_reporter_number\"><mutation duplicateondrag=\"true\"></mutation><field name=\"VALUE\">kd</field></block></value><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"qJvB3{^1l;)xyh(275=#\">線位置</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"sensor_Line\"></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"@t.dz.RC{JAoM!;Xa)Jo\">Error_P</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"qJvB3{^1l;)xyh(275=#\">線位置</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"i%EQgp!vNEzfk0|+U|s`\">Error_D</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"@t.dz.RC{JAoM!;Xa)Jo\">Error_P</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";YwuBZ8Kx.t6fj%eZ/Ge\">Error_P_old</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\";YwuBZ8Kx.t6fj%eZ/Ge\">Error_P_old</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"@t.dz.RC{JAoM!;Xa)Jo\">Error_P</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"]ccrS5EHHCfoj_yO+hdh\">PID_Val</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"@t.dz.RC{JAoM!;Xa)Jo\">Error_P</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">kp</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"i%EQgp!vNEzfk0|+U|s`\">Error_D</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">kd</field></block></value></block></value></block></value><next><block type=\"motor_MotorRun\"><field name=\"index\">BitRacer.Motors.M_R</field><value name=\"PWM\"><shadow type=\"math_number_minmax\"><mutation min=\"-1000\" max=\"1000\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_constrain_value\"><value name=\"value\"><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">基礎速度</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"]ccrS5EHHCfoj_yO+hdh\">PID_Val</field></block></value></block></value><value name=\"low\"><shadow type=\"math_number\"><field name=\"NUM\">-1000</field></shadow></value><value name=\"high\"><shadow type=\"math_number\"><field name=\"NUM\">1000</field></shadow></value></block></value><next><block type=\"motor_MotorRun\"><field name=\"index\">BitRacer.Motors.M_L</field><value name=\"PWM\"><shadow type=\"math_number_minmax\"><mutation min=\"-1000\" max=\"1000\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_constrain_value\"><value name=\"value\"><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">基礎速度</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"]ccrS5EHHCfoj_yO+hdh\">PID_Val</field></block></value></block></value><value name=\"low\"><shadow type=\"math_number\"><field name=\"NUM\">-1000</field></shadow></value><value name=\"high\"><shadow type=\"math_number\"><field name=\"NUM\">1000</field></shadow></value></block></value></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"1708\" y=\"20\"><mutation name=\"判斷標記線\" functionid=\"z8EX^yfG|oIFu[@+Rq7o\"></mutation><field name=\"function_name\">判斷標記線</field><comment pinned=\"false\" h=\"80\" w=\"160\">偵測標記線的函式</comment><statement name=\"STACK\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/XBBo+}cltT28L%VnATN\">紅外線IR5</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1000</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">50</field></shadow></value><next><block type=\"variables_change\"><field name=\"VAR\" id=\"5QwXe*=A.z8P_/:iiXFs\">標記線計數</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">basic.showNumber(標記線計數); // 顯示當前標記線數量\nmusic.play(music.tonePlayable(988, music.beat(BeatFraction.Whole)), music.PlaybackMode.UntilDone);\nbasic.showIcon(IconNames.No);</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"5QwXe*=A.z8P_/:iiXFs\">標記線計數</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"LvaO%H8^0ZHA1a`+@QPe\">總標記線數量</field></block></value></block></value><statement name=\"DO0\"><block type=\"motor_MotorRun\"><field name=\"index\">BitRacer.Motors.All</field><comment pinned=\"false\" h=\"80\" w=\"160\">到達最後一條標記線，停止動作</comment><value name=\"PWM\"><shadow type=\"math_number_minmax\"><mutation min=\"-1000\" max=\"1000\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow></value></block></statement><statement name=\"ELSE\"><block type=\"function_call\"><mutation name=\"巡白線\" functionid=\"wCxxf0@/-x6ktsm6Dwpk\"></mutation></block></statement></block></next></block></next></block></statement></block></statement></block><block type=\"function_definition\" x=\"2279\" y=\"20\"><mutation name=\"巡白線\" functionid=\"wCxxf0@/-x6ktsm6Dwpk\"></mutation><field name=\"function_name\">巡白線</field><comment pinned=\"false\" h=\"80\" w=\"160\">主程式，用來巡線並偵測終點及標記線</comment><statement name=\"STACK\"><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"5QwXe*=A.z8P_/:iiXFs\">標記線計數</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"LvaO%H8^0ZHA1a`+@QPe\">總標記線數量</field></block></value></block></value><statement name=\"DO\"><block type=\"function_call\"><mutation name=\"設定PID控制器\" functionid=\"MYNFoD,tACwb(%#-_!Lz\"><arg name=\"基礎速度\" id=\"bb042lfh929sybv5jdmvor\" type=\"number\"></arg><arg name=\"kp\" id=\"g26ojmjt5jflw24psjzu\" type=\"number\"></arg><arg name=\"kd\" id=\"r6q6b1big4eitjv0gnlg\" type=\"number\"></arg></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">基礎速度和PID控制</comment><value name=\"bb042lfh929sybv5jdmvor\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"{f!}ythzvVcmXeb^C)[X\">基礎速度</field></block></value><value name=\"g26ojmjt5jflw24psjzu\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"2FvlfyBUR@I.?+^t.maK\">kp</field></block></value><value name=\"r6q6b1big4eitjv0gnlg\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"QOI+`Dv`3bLK{@(O*3:P\">kd</field></block></value><next><block type=\"function_call\"><mutation name=\"讀取紅外線\" functionid=\"0CL^%#u9MV_2[:W,Qv)0\"></mutation><next><block type=\"function_call\"><mutation name=\"判斷標記線\" functionid=\"z8EX^yfG|oIFu[@+Rq7o\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">檢查標記線</comment><next><block type=\"function_call\"><mutation name=\"判斷左普左彎\" functionid=\"xXz+-W0Z!2J?b7wrQk4q\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">判斷終點();</comment><next><block type=\"function_call\"><mutation name=\"判斷右普右彎\" functionid=\"Y$GCBkS1sh61h.Vw=7wh\"></mutation><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"5QwXe*=A.z8P_/:iiXFs\">標記線計數</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"LvaO%H8^0ZHA1a`+@QPe\">總標記線數量</field></block></value></block></value><statement name=\"DO0\"><block type=\"break_keyword\"></block></statement></block></next></block></next></block></next></block></next></block></next></block></statement></block></statement></block><block type=\"function_definition\" x=\"20\" y=\"634\"><mutation name=\"讀取紅外線\" functionid=\"0CL^%#u9MV_2[:W,Qv)0\"></mutation><field name=\"function_name\">讀取紅外線</field><comment pinned=\"false\" h=\"80\" w=\"160\">讀取紅外線感應器的數值</comment><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"qK|[aR#,=G%z!9(?rbhx\">紅外線IR1</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"sensor_readIR2\"><value name=\"SensorID\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">1</field></shadow></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\",G-^7C)MAv8r9.$X.:Xx\">紅外線IR2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"sensor_readIR2\"><value name=\"SensorID\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">2</field></shadow></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"Jw*5#gXrBmZOh38I3nqt\">紅外線IR3</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"sensor_readIR2\"><value name=\"SensorID\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">3</field></shadow></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"b],5rysk1-X{_h.%t.#8\">紅外線IR4</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"sensor_readIR2\"><value name=\"SensorID\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">4</field></shadow></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"/XBBo+}cltT28L%VnATN\">紅外線IR5</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"sensor_readIR2\"><value name=\"SensorID\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">5</field></shadow></value></block></value></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"509\" y=\"634\"><mutation name=\"判斷左普左彎\" functionid=\"xXz+-W0Z!2J?b7wrQk4q\"></mutation><field name=\"function_name\">判斷左普左彎</field><comment pinned=\"false\" h=\"80\" w=\"160\">偵測十字路口或T字路口</comment><statement name=\"STACK\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"qK|[aR#,=G%z!9(?rbhx\">紅外線IR1</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1000</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"`N34KA-DK3c.|a!):Wz:\">右邊紅外線狀態</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"8g;rxVKmdID^*}zkstji\">左邊紅外線狀態</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"L+`fkAF9r9s9h}-=/#7p\">中間紅外線狀態</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Fj?ln2!k)eDz5_4$fYJ4\">路口</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">左普</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"a%^:I=.%QgtsoX;|cx)c\">路口型態</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></block></next></block></statement><statement name=\"ELSE\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Fj?ln2!k)eDz5_4$fYJ4\">路口</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">左彎</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"a%^:I=.%QgtsoX;|cx)c\">路口型態</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"bwt$D7.oL(/do:4Fiy5i\">路口判斷結束</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></statement></block></statement></block><block type=\"function_definition\" x=\"1738\" y=\"634\"><mutation name=\"判斷右普右彎\" functionid=\"Y$GCBkS1sh61h.Vw=7wh\"></mutation><field name=\"function_name\">判斷右普右彎</field><comment pinned=\"false\" h=\"80\" w=\"160\">偵測右轉或右彎</comment><statement name=\"STACK\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">OR</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"qK|[aR#,=G%z!9(?rbhx\">紅外線IR1</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1000</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"`N34KA-DK3c.|a!):Wz:\">右邊紅外線狀態</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"8g;rxVKmdID^*}zkstji\">左邊紅外線狀態</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"L+`fkAF9r9s9h}-=/#7p\">中間紅外線狀態</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Fj?ln2!k)eDz5_4$fYJ4\">路口</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">右普</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"a%^:I=.%QgtsoX;|cx)c\">路口型態</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value></block></next></block></statement><statement name=\"ELSE\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Fj?ln2!k)eDz5_4$fYJ4\">路口</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">右彎</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"a%^:I=.%QgtsoX;|cx)c\">路口型態</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value></block></next></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"bwt$D7.oL(/do:4Fiy5i\">路口判斷結束</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></statement></block></statement></block><"],[0,"/xml>"]],"start1":1277,"start2":1277,"length1":13,"length2":23182}]},{"type":"edited","filename":"main.py","patch":[{"diffs":[[0,"記線數量 = 1"],[-1,"4"],[1,"0"],[0,"\n基礎速度 = "]],"start1":12,"start2":12,"length1":17,"length2":17},{"diffs":[[0,"p = "],[-1,"2"],[1,"1"],[0,"50\nkd = "],[-1,"2"],[0,"1"],[1,"8"],[0,"0\n紅外"]],"start1":34,"start2":34,"length1":19,"length2":19},{"diffs":[[0," if "],[-1,"(紅外線IR1 > 1000) or "],[0,"(紅外線"]],"start1":768,"start2":768,"length1":27,"length2":8},{"diffs":[[0,"  巡白線()\n"],[1,"# 偵測十字路口或T字路口\ndef 判斷左普左彎():\n    global 路口, 路口型態, 路口判斷結束\n    if 紅外線IR1 < 1000 and 右邊紅外線狀態 == 0 and 左邊紅外線狀態 == 1:\n        if 中間紅外線狀態 == 1:\n            路口 = \"左普\"\n            路口型態 = 3\n        else:\n            路口 = \"左彎\"\n            路口型態 = 1\n        路口判斷結束 = 1\n# 偵測右轉或右彎\ndef 判斷右普右彎():\n    global 路口, 路口型態, 路口判斷結束\n    if (紅外線IR1 < 1000) or (右邊紅外線狀態 == 1 and 左邊紅外線狀態 == 0):\n        if 中間紅外線狀態 == 1:\n            路口 = \"右普\"\n            路口型態 = 6\n        else:\n            路口 = \"右彎\"\n            路口型態 = 4\n        路口判斷結束 = 1\n"],[0,"# 讀取紅外線感"]],"start1":1165,"start2":1165,"length1":16,"length2":527},{"diffs":[[0,"測終點及標記線\n"],[-1,"# 主程式，用來巡線並偵測終點及標記線\n"],[0,"def 巡白線("]],"start1":1943,"start2":1943,"length1":36,"length2":16},{"diffs":[[0,"  while "],[1,"("],[0,"標記線計數 < "]],"start1":1964,"start2":1964,"length1":16,"length2":17},{"diffs":[[0,"線計數 < 總標記線數量"],[1,")"],[0,":\n        # "]],"start1":1975,"start2":1975,"length1":24,"length2":25},{"diffs":[[0,"    "],[-1,"# 如果 IR1 < 1000，就執行右轉\n        # 持續右轉的時間\n        if 紅外線IR1 > 1000:\n            BitRacer.motor_run(BitRacer.Motors.M_R, 基礎速度 - 50)\n    "],[1,"判斷標記線()\n"],[0,"    "]],"start1":2062,"start2":2062,"length1":141,"length2":16},{"diffs":[[0,"  # "],[-1,"減速右側馬達"],[1,"檢查標記線"],[0,"\n   "]],"start1":2080,"start2":2080,"length1":14,"length2":13},{"diffs":[[0,"    "],[-1,"    BitRacer.motor_run(BitRacer.Motors.M_L, 基礎速度 + 50)\n            # 加速左側馬達\n            basic.pause(200"],[1,"# 判斷終點();\n        判斷左普左彎("],[0,")\n  "]],"start1":2094,"start2":2094,"length1":111,"length2":33},{"diffs":[[0,"      判斷"],[-1,"標記線"],[1,"右普右彎"],[0,"()\n"],[-1,"        # 檢查標記線\n"],[0,"        "]],"start1":2127,"start2":2127,"length1":38,"length2":23},{"diffs":[[0,"始巡線\n"],[-1,"# music.play(music.tonePlayable(988, music.beat(BeatFraction.Whole)), music.PlaybackMode.UntilDone);\n# basic.showIcon(IconNames.Square);\n"],[0,"# ba"]],"start1":2198,"start2":2198,"length1":145,"length2":8},{"diffs":[[0,"  巡白線()\n"],[1,"    # music.play(music.tonePlayable(988, music.beat(BeatFraction.Whole)), music.PlaybackMode.UntilDone);\n    # basic.showIcon(IconNames.Square);\n    basic.pause(1000)\n"],[0,"input.on"]],"start1":2436,"start2":2436,"length1":16,"length2":183}]},{"type":"edited","filename":"main.ts","patch":[{"diffs":[[0,"記線計數 = 0"],[-1,"\nle"],[1,";\ncons"],[0,"t 總標記線數量"]],"start1":5,"start2":5,"length1":19,"length2":22},{"diffs":[[0,"線數量 = 14"],[1,";"],[0,"\nlet 基礎速"]],"start1":24,"start2":24,"length1":16,"length2":17},{"diffs":[[0,"速度 = 200"],[1,";"],[0,"\nlet kp "]],"start1":40,"start2":40,"length1":16,"length2":17},{"diffs":[[0,"p = "],[-1,"2"],[1,"1"],[0,"50"],[1,";"],[0,"\nlet"]],"start1":55,"start2":55,"length1":11,"length2":12},{"diffs":[[0,"d = "],[-1,"210"],[1,"180;"],[0,"\nlet"]],"start1":69,"start2":69,"length1":11,"length2":12},{"diffs":[[0,"t 紅外線IR1 = 0"],[1,";"],[0,"\nlet 紅外線IR2 "]],"start1":80,"start2":80,"length1":24,"length2":25},{"diffs":[[0,"t 紅外線IR2 = 0"],[1,";"],[0,"\nlet 紅外線IR4 "]],"start1":96,"start2":96,"length1":24,"length2":25},{"diffs":[[0,"t 紅外線IR4 = 0"],[1,";"],[0,"\nlet 紅外線IR3 "]],"start1":112,"start2":112,"length1":24,"length2":25},{"diffs":[[0,"t 紅外線IR3 = 0"],[1,";"],[0,"\nlet 紅外線IR5 "]],"start1":128,"start2":128,"length1":24,"length2":25},{"diffs":[[0,"t 紅外線IR5 = 0"],[1,";"],[0,"\nlet Error_P"]],"start1":144,"start2":144,"length1":24,"length2":25},{"diffs":[[0,"or_P_old = 0"],[1,";"],[0,"\nlet Error_D"]],"start1":165,"start2":165,"length1":24,"length2":25},{"diffs":[[0," Error_D = 0"],[1,";"],[0,"\nlet Error_P"]],"start1":182,"start2":182,"length1":24,"length2":25},{"diffs":[[0," Error_P = 0"],[1,";"],[0,"\nlet PID_Val"]],"start1":199,"start2":199,"length1":24,"length2":25},{"diffs":[[0," PID_Val = 0"],[1,";"],[0,"\nlet 線位置 = 0"]],"start1":216,"start2":216,"length1":24,"length2":25},{"diffs":[[0,"\nlet 線位置 = 0"],[1,";"],[0,"\nlet 終點時間 = "]],"start1":229,"start2":229,"length1":24,"length2":25},{"diffs":[[0,"let 終點時間 = 0"],[1,";"],[0,"\nlet 找到終點 = "]],"start1":243,"start2":243,"length1":24,"length2":25},{"diffs":[[0,"let 找到終點 = 0"],[1,";"],[0,"\nlet 中間紅外線狀態"]],"start1":257,"start2":257,"length1":24,"length2":25},{"diffs":[[0," 中間紅外線狀態 = 0"],[1,";"],[0,"\nlet 左邊紅外線狀態"]],"start1":274,"start2":274,"length1":24,"length2":25},{"diffs":[[0," 左邊紅外線狀態 = 0"],[1,";"],[0,"\nlet 右邊紅外線狀態"]],"start1":291,"start2":291,"length1":24,"length2":25},{"diffs":[[0," 右邊紅外線狀態 = 0"],[1,";"],[0,"\nlet 路口 = \"\""]],"start1":308,"start2":308,"length1":24,"length2":25},{"diffs":[[0," 路口 = \"\""],[1,";"],[0,"\nlet 路口型"]],"start1":325,"start2":325,"length1":16,"length2":17},{"diffs":[[0,"路口型態 = 0"],[1,";"],[0,"\nlet 路口判"]],"start1":339,"start2":339,"length1":16,"length2":17},{"diffs":[[0,"判斷結束 = 0"],[1,";\n"],[0,"\n//"],[-1," "],[0," 設定PID控制"]],"start1":355,"start2":355,"length1":20,"length2":21},{"diffs":[[0,"控制器(基礎速度"],[-1,"2"],[0,": number"]],"start1":392,"start2":392,"length1":17,"length2":16},{"diffs":[[0,"mber, kp"],[-1,"2"],[0,": number"]],"start1":404,"start2":404,"length1":17,"length2":16},{"diffs":[[0,"mber, kd"],[-1,"2"],[0,": number"]],"start1":416,"start2":416,"length1":17,"length2":16},{"diffs":[[0,": number) {\n"],[-1,"    \n"],[0,"    線位置 = Bi"]],"start1":424,"start2":424,"length1":29,"length2":24},{"diffs":[[0," 0 - 線位置"],[1,";"],[0,"\n    Err"]],"start1":479,"start2":479,"length1":16,"length2":17},{"diffs":[[0,"or_P_old"],[1,";"],[0,"\n    Err"]],"start1":516,"start2":516,"length1":16,"length2":17},{"diffs":[[0," Error_P"],[1,";"],[0,"\n    PID"]],"start1":543,"start2":543,"length1":16,"length2":17},{"diffs":[[0,"r_P * kp"],[-1,"2"],[0," + Error"]],"start1":571,"start2":571,"length1":17,"length2":16},{"diffs":[[0,"r_D * kd"],[-1,"2"],[1,";"],[0,"\n    Bit"]],"start1":586,"start2":586,"length1":17,"length2":17},{"diffs":[[0,"ain(基礎速度"],[-1,"2"],[0," + PID_V"]],"start1":650,"start2":650,"length1":17,"length2":16},{"diffs":[[0,", 1000))"],[1,";"],[0,"\n    Bit"]],"start1":675,"start2":675,"length1":16,"length2":17},{"diffs":[[0,"ain(基礎速度"],[-1,"2"],[0," - PID_V"]],"start1":739,"start2":739,"length1":17,"length2":16},{"diffs":[[0,", 1000))"],[1,";"],[0,"\n}\n\n//"],[-1," "],[0," 偵測標記線的函"]],"start1":764,"start2":764,"length1":23,"length2":23},{"diffs":[[0,") {\n"],[-1,"    \n"],[0,"    if "],[1,"("],[0,"(紅外線"]],"start1":804,"start2":804,"length1":20,"length2":16},{"diffs":[[0,"1000"],[-1," "],[1,")"],[0,"|| "],[1,"("],[0,"紅外線I"]],"start1":826,"start2":826,"length1":12,"length2":13},{"diffs":[[0," (紅外線IR5 > 1000)"],[1,")"],[0," {\n        basic"]],"start1":833,"start2":833,"length1":32,"length2":33},{"diffs":[[0,"ause(50)"],[1,";"],[0,"\n       "]],"start1":868,"start2":868,"length1":16,"length2":17},{"diffs":[[0,"線計數 += 1"],[1,";"],[0,"\n       "]],"start1":888,"start2":888,"length1":16,"length2":17},{"diffs":[[0,"+= 1;\n        //"],[-1,"  "],[0,"basic.showNumber"]],"start1":892,"start2":892,"length1":34,"length2":32},{"diffs":[[0,"當前標記線數量\n"],[1,"\n        if (標記線計數 >= 總標記線數量) {\n            // 到達最後一條標記線，停止動作\n            BitRacer.motorRun(BitRacer.Motors.All, 0);\n    "],[0,"        "]],"start1":938,"start2":938,"length1":16,"length2":137},{"diffs":[[0,"      //"],[-1,"  "],[0,"music.pl"]],"start1":1069,"start2":1069,"length1":18,"length2":16},{"diffs":[[0,"        "],[-1,"//"],[0,"  "],[1,"  //"],[0,"basic.sh"]],"start1":1176,"start2":1176,"length1":20,"length2":22},{"diffs":[[0,"o);\n"],[-1,"        if (標記線計數 >= 總標記線數量) {\n            //  到達最後一條標記線，停止動作\n            BitRacer.motorRun(BitRacer.Motors.All, 0)\n"],[0,"    "]],"start1":1216,"start2":1216,"length1":124,"length2":8},{"diffs":[[0,"   巡白線()"],[1,";"],[0,"\n       "]],"start1":1246,"start2":1246,"length1":16,"length2":17},{"diffs":[[0,"    "],[-1,"    \n    }\n    \n}"],[1,"}\n}\n\n"],[0,"\n\n//"],[-1," "],[0," 讀取紅"]],"start1":1266,"start2":1266,"length1":30,"length2":17},{"diffs":[[0,"n 讀取紅外線() {\n"],[-1,"    \n"],[0,"    紅外線IR1 ="]],"start1":1299,"start2":1299,"length1":29,"length2":24},{"diffs":[[0,"adIR2(1)"],[1,";"],[0,"\n    紅外線"]],"start1":1335,"start2":1335,"length1":16,"length2":17},{"diffs":[[0,"adIR2(2)"],[1,";"],[0,"\n    紅外線"]],"start1":1369,"start2":1369,"length1":16,"length2":17},{"diffs":[[0,"adIR2(3)"],[1,";"],[0,"\n    紅外線"]],"start1":1403,"start2":1403,"length1":16,"length2":17},{"diffs":[[0,"adIR2(4)"],[1,";"],[0,"\n    紅外線"]],"start1":1437,"start2":1437,"length1":16,"length2":17},{"diffs":[[0,"adIR2(5)"],[1,";"],[0,"\n}\n\n//"],[-1," "],[0," 主程式，用來巡"]],"start1":1471,"start2":1471,"length1":23,"length2":23},{"diffs":[[0,"點及標記線\n//"],[-1," "],[0," 主程式，用來巡"]],"start1":1499,"start2":1499,"length1":17,"length2":16},{"diffs":[[0,"      //"],[-1," "],[0," 基礎速度和PI"]],"start1":1574,"start2":1574,"length1":17,"length2":16},{"diffs":[[0," kp, kd)"],[1,";"],[0,"\n       "]],"start1":1616,"start2":1616,"length1":16,"length2":17},{"diffs":[[0," 讀取紅外線()"],[1,";\n"],[0,"\n       "]],"start1":1633,"start2":1633,"length1":16,"length2":18},{"diffs":[[0,"      //"],[-1," "],[0," 如果 IR1 "]],"start1":1646,"start2":1646,"length1":17,"length2":16},{"diffs":[[0,"行右轉\n"],[-1,"        //  持續右轉的時間\n"],[0,"    "]],"start1":1671,"start2":1671,"length1":28,"length2":8},{"diffs":[[0,"if (紅外線IR1 >"],[-1," "],[0,"1000) {\n    "]],"start1":1683,"start2":1683,"length1":25,"length2":24},{"diffs":[[0,"速度 - 50)"],[-1,"\n           "],[1,";"],[0," //"],[-1," "],[0," 減速右側馬達\n"]],"start1":1756,"start2":1756,"length1":32,"length2":20},{"diffs":[[0,"速度 + 50)"],[-1,"\n           "],[1,";"],[0," //"],[-1," "],[0," 加速左側馬達\n"]],"start1":1829,"start2":1829,"length1":32,"length2":20},{"diffs":[[0,"use(200)"],[1,"; // 持續右轉的時間"],[0,"\n       "]],"start1":1869,"start2":1869,"length1":16,"length2":28},{"diffs":[[0,"間\n        }\n"],[-1,"        "],[0,"\n        判斷標"]],"start1":1888,"start2":1888,"length1":32,"length2":24},{"diffs":[[0," 判斷標記線()"],[-1,"\n       "],[1,";"],[0," //"],[-1," "],[0," 檢查標記線\n "]],"start1":1908,"start2":1908,"length1":28,"length2":20},{"diffs":[[0,"   break"],[1,";"],[0,"\n       "]],"start1":1967,"start2":1967,"length1":16,"length2":17},{"diffs":[[0,"  }\n"],[-1,"        \n"],[0,"    "]],"start1":1983,"start2":1983,"length1":17,"length2":8},{"diffs":[[0," }\n}\n\n//"],[-1," "],[0," 按下 A 鍵後"]],"start1":1990,"start2":1990,"length1":17,"length2":16},{"diffs":[[0," 鍵後開始巡線\n"],[-1,"//"],[1,"input.onButtonPressed(Button.A, function () {\n  "],[0,"  music."]],"start1":2003,"start2":2003,"length1":18,"length2":64},{"diffs":[[0,"e);\n"],[-1,"//"],[1,"  "],[0,"  basic."],[-1,"showIcon(IconNames.Square);\n//  basic.clearScreen();\ninput.onButtonPressed(Button.A, function on_button_pressed_a() {\n    "],[1,"pause(1000);\n    //找到終點 = 0;\n    標記線計數 = 0;\n    巡白線();\n"],[0,"\n    "],[1,"//"],[0,"musi"]],"start1":2156,"start2":2156,"length1":145,"length2":80},{"diffs":[[0,"one)"],[1,";"],[0,"\n    "],[1,"//"],[0,"basic."],[-1,"pause(1000)\n    //  找到終點 = 0;\n    標記線計數 = 0\n    巡白線"],[1,"showIcon(IconNames.Square);\n    //basic.clearScreen"],[0,"()"],[1,";"],[0,"\n})"],[-1,"\n"],[1,";"]],"start1":2325,"start2":2325,"length1":72,"length2":76}]},{"type":"edited","filename":"pxt.json","patch":[{"diffs":[[0," ],\n"],[-1,"    \"testFiles\": [\n        \"test.ts\"\n    ],\n"],[0,"    "]],"start1":344,"start2":344,"length1":52,"length2":8},{"diffs":[[0,"itor\": \""],[-1,"py"],[1,"ts"],[0,"prj\"\n}\n"]],"start1":447,"start2":447,"length1":17,"length2":17}]},{"type":"added","filename":"test.ts","value":"// 在這裡測試；當此封包作為擴充功能時，將不會編譯此內容。\n"}]}],"snapshots":[{"timestamp":1736949101140,"editorVersion":"7.0.57","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable id=\"qJvB3{^1l;)xyh(275=#\">線位置</variable><variable id=\"@t.dz.RC{JAoM!;Xa)Jo\">Error_P</variable><variable id=\"i%EQgp!vNEzfk0|+U|s`\">Error_D</variable><variable id=\";YwuBZ8Kx.t6fj%eZ/Ge\">Error_P_old</variable><variable id=\"]ccrS5EHHCfoj_yO+hdh\">PID_Val</variable><variable id=\"/XBBo+}cltT28L%VnATN\">紅外線IR5</variable><variable id=\"5QwXe*=A.z8P_/:iiXFs\">標記線計數</variable><variable id=\"LvaO%H8^0ZHA1a`+@QPe\">總標記線數量</variable><variable id=\"qK|[aR#,=G%z!9(?rbhx\">紅外線IR1</variable><variable id=\"`N34KA-DK3c.|a!):Wz:\">右邊紅外線狀態</variable><variable id=\"8g;rxVKmdID^*}zkstji\">左邊紅外線狀態</variable><variable id=\"L+`fkAF9r9s9h}-=/#7p\">中間紅外線狀態</variable><variable id=\"Fj?ln2!k)eDz5_4$fYJ4\">路口</variable><variable id=\"a%^:I=.%QgtsoX;|cx)c\">路口型態</variable><variable id=\"bwt$D7.oL(/do:4Fiy5i\">路口判斷結束</variable><variable id=\",G-^7C)MAv8r9.$X.:Xx\">紅外線IR2</variable><variable id=\"Jw*5#gXrBmZOh38I3nqt\">紅外線IR3</variable><variable id=\"b],5rysk1-X{_h.%t.#8\">紅外線IR4</variable><variable id=\"{f!}ythzvVcmXeb^C)[X\">基礎速度</variable><variable id=\"2FvlfyBUR@I.?+^t.maK\">kp</variable><variable id=\"QOI+`Dv`3bLK{@(O*3:P\">kd</variable><variable id=\"K:8{tX4[_b6={i8yzhY4\">找到終點</variable><variable id=\"!TvgL[]?w-ivmTrPRiPq\">終點時間</variable></variables><block type=\"pxt-on-start\" x=\"20\" y=\"20\"><statement name=\"HANDLER\"><block type=\"variables_set\"><field name=\"VAR\" id=\"K:8{tX4[_b6={i8yzhY4\">找到終點</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"!TvgL[]?w-ivmTrPRiPq\">終點時間</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"LvaO%H8^0ZHA1a`+@QPe\">總標記線數量</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">10</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"{f!}ythzvVcmXeb^C)[X\">基礎速度</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">200</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"2FvlfyBUR@I.?+^t.maK\">kp</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">150</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"QOI+`Dv`3bLK{@(O*3:P\">kd</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">180</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"device_button_event\" x=\"360\" y=\"20\"><field name=\"NAME\">Button.A</field><comment pinned=\"false\" h=\"80\" w=\"160\">按下 A 鍵後開始巡線\nbasic.clearScreen();</comment><statement name=\"HANDLER\"><block type=\"music_playable_play\"><field name=\"playbackMode\">music.PlaybackMode.UntilDone</field><value name=\"toPlay\"><shadow type=\"music_string_playable\"></shadow><block type=\"music_tone_playable\"><value name=\"note\"><shadow type=\"device_note\"><field name=\"name\">988</field></shadow></value><value name=\"duration\"><shadow type=\"device_beat\"><field name=\"fraction\">BeatFraction.Whole</field></shadow></value></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">1000</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"5QwXe*=A.z8P_/:iiXFs\">標記線計數</field><comment pinned=\"false\" h=\"80\" w=\"160\">找到終點 = 0;</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"function_call\"><mutation name=\"巡白線\" functionid=\"wCxxf0@/-x6ktsm6Dwpk\"></mutation><next><block type=\"device_pause\"><comment pinned=\"false\" h=\"80\" w=\"160\">music.play(music.tonePlayable(988, music.beat(BeatFraction.Whole)), music.PlaybackMode.UntilDone);\nbasic.showIcon(IconNames.Square);</comment><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">1000</field></shadow></value></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"884\" y=\"20\"><mutation name=\"設定PID控制器\" functionid=\"MYNFoD,tACwb(%#-_!Lz\"><arg name=\"基礎速度\" id=\"bb042lfh929sybv5jdmvor\" type=\"number\"></arg><arg name=\"kp\" id=\"g26ojmjt5jflw24psjzu\" type=\"number\"></arg><arg name=\"kd\" id=\"r6q6b1big4eitjv0gnlg\" type=\"number\"></arg></mutation><field name=\"function_name\">設定PID控制器</field><comment pinned=\"false\" h=\"80\" w=\"160\">設定PID控制器</comment><value name=\"bb042lfh929sybv5jdmvor\"><block type=\"argument_reporter_number\"><mutation duplicateondrag=\"true\"></mutation><field name=\"VALUE\">基礎速度</field></block></value><value name=\"g26ojmjt5jflw24psjzu\"><block type=\"argument_reporter_number\"><mutation duplicateondrag=\"true\"></mutation><field name=\"VALUE\">kp</field></block></value><value name=\"r6q6b1big4eitjv0gnlg\"><block type=\"argument_reporter_number\"><mutation duplicateondrag=\"true\"></mutation><field name=\"VALUE\">kd</field></block></value><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"qJvB3{^1l;)xyh(275=#\">線位置</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"sensor_Line\"></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"@t.dz.RC{JAoM!;Xa)Jo\">Error_P</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"qJvB3{^1l;)xyh(275=#\">線位置</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"i%EQgp!vNEzfk0|+U|s`\">Error_D</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"@t.dz.RC{JAoM!;Xa)Jo\">Error_P</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\";YwuBZ8Kx.t6fj%eZ/Ge\">Error_P_old</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\";YwuBZ8Kx.t6fj%eZ/Ge\">Error_P_old</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"@t.dz.RC{JAoM!;Xa)Jo\">Error_P</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"]ccrS5EHHCfoj_yO+hdh\">PID_Val</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"@t.dz.RC{JAoM!;Xa)Jo\">Error_P</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">kp</field></block></value></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"i%EQgp!vNEzfk0|+U|s`\">Error_D</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">kd</field></block></value></block></value></block></value><next><block type=\"motor_MotorRun\"><field name=\"index\">BitRacer.Motors.M_R</field><value name=\"PWM\"><shadow type=\"math_number_minmax\"><mutation min=\"-1000\" max=\"1000\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_constrain_value\"><value name=\"value\"><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">基礎速度</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"]ccrS5EHHCfoj_yO+hdh\">PID_Val</field></block></value></block></value><value name=\"low\"><shadow type=\"math_number\"><field name=\"NUM\">-1000</field></shadow></value><value name=\"high\"><shadow type=\"math_number\"><field name=\"NUM\">1000</field></shadow></value></block></value><next><block type=\"motor_MotorRun\"><field name=\"index\">BitRacer.Motors.M_L</field><value name=\"PWM\"><shadow type=\"math_number_minmax\"><mutation min=\"-1000\" max=\"1000\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow><block type=\"math_constrain_value\"><value name=\"value\"><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">基礎速度</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"]ccrS5EHHCfoj_yO+hdh\">PID_Val</field></block></value></block></value><value name=\"low\"><shadow type=\"math_number\"><field name=\"NUM\">-1000</field></shadow></value><value name=\"high\"><shadow type=\"math_number\"><field name=\"NUM\">1000</field></shadow></value></block></value></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"1708\" y=\"20\"><mutation name=\"判斷標記線\" functionid=\"z8EX^yfG|oIFu[@+Rq7o\"></mutation><field name=\"function_name\">判斷標記線</field><comment pinned=\"false\" h=\"80\" w=\"160\">偵測標記線的函式</comment><statement name=\"STACK\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/XBBo+}cltT28L%VnATN\">紅外線IR5</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1000</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">50</field></shadow></value><next><block type=\"variables_change\"><field name=\"VAR\" id=\"5QwXe*=A.z8P_/:iiXFs\">標記線計數</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">basic.showNumber(標記線計數); // 顯示當前標記線數量\nmusic.play(music.tonePlayable(988, music.beat(BeatFraction.Whole)), music.PlaybackMode.UntilDone);\nbasic.showIcon(IconNames.No);</comment><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"5QwXe*=A.z8P_/:iiXFs\">標記線計數</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"LvaO%H8^0ZHA1a`+@QPe\">總標記線數量</field></block></value></block></value><statement name=\"DO0\"><block type=\"motor_MotorRun\"><field name=\"index\">BitRacer.Motors.All</field><comment pinned=\"false\" h=\"80\" w=\"160\">到達最後一條標記線，停止動作</comment><value name=\"PWM\"><shadow type=\"math_number_minmax\"><mutation min=\"-1000\" max=\"1000\" precision=\"0\"></mutation><field name=\"SLIDER\">0</field></shadow></value></block></statement><statement name=\"ELSE\"><block type=\"function_call\"><mutation name=\"巡白線\" functionid=\"wCxxf0@/-x6ktsm6Dwpk\"></mutation></block></statement></block></next></block></next></block></statement></block></statement></block><block type=\"function_definition\" x=\"2279\" y=\"20\"><mutation name=\"巡白線\" functionid=\"wCxxf0@/-x6ktsm6Dwpk\"></mutation><field name=\"function_name\">巡白線</field><comment pinned=\"false\" h=\"80\" w=\"160\">主程式，用來巡線並偵測終點及標記線</comment><statement name=\"STACK\"><block type=\"device_while\"><value name=\"COND\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"5QwXe*=A.z8P_/:iiXFs\">標記線計數</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"LvaO%H8^0ZHA1a`+@QPe\">總標記線數量</field></block></value></block></value><statement name=\"DO\"><block type=\"function_call\"><mutation name=\"設定PID控制器\" functionid=\"MYNFoD,tACwb(%#-_!Lz\"><arg name=\"基礎速度\" id=\"bb042lfh929sybv5jdmvor\" type=\"number\"></arg><arg name=\"kp\" id=\"g26ojmjt5jflw24psjzu\" type=\"number\"></arg><arg name=\"kd\" id=\"r6q6b1big4eitjv0gnlg\" type=\"number\"></arg></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">基礎速度和PID控制</comment><value name=\"bb042lfh929sybv5jdmvor\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"{f!}ythzvVcmXeb^C)[X\">基礎速度</field></block></value><value name=\"g26ojmjt5jflw24psjzu\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"2FvlfyBUR@I.?+^t.maK\">kp</field></block></value><value name=\"r6q6b1big4eitjv0gnlg\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"QOI+`Dv`3bLK{@(O*3:P\">kd</field></block></value><next><block type=\"function_call\"><mutation name=\"讀取紅外線\" functionid=\"0CL^%#u9MV_2[:W,Qv)0\"></mutation><next><block type=\"function_call\"><mutation name=\"判斷標記線\" functionid=\"z8EX^yfG|oIFu[@+Rq7o\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">檢查標記線</comment><next><block type=\"function_call\"><mutation name=\"判斷左普左彎\" functionid=\"xXz+-W0Z!2J?b7wrQk4q\"></mutation><comment pinned=\"false\" h=\"80\" w=\"160\">判斷終點();</comment><next><block type=\"function_call\"><mutation name=\"判斷右普右彎\" functionid=\"Y$GCBkS1sh61h.Vw=7wh\"></mutation><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GTE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"5QwXe*=A.z8P_/:iiXFs\">標記線計數</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"LvaO%H8^0ZHA1a`+@QPe\">總標記線數量</field></block></value></block></value><statement name=\"DO0\"><block type=\"break_keyword\"></block></statement></block></next></block></next></block></next></block></next></block></next></block></statement></block></statement></block><block type=\"function_definition\" x=\"20\" y=\"634\"><mutation name=\"讀取紅外線\" functionid=\"0CL^%#u9MV_2[:W,Qv)0\"></mutation><field name=\"function_name\">讀取紅外線</field><comment pinned=\"false\" h=\"80\" w=\"160\">讀取紅外線感應器的數值</comment><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\"qK|[aR#,=G%z!9(?rbhx\">紅外線IR1</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"sensor_readIR2\"><value name=\"SensorID\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">1</field></shadow></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\",G-^7C)MAv8r9.$X.:Xx\">紅外線IR2</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"sensor_readIR2\"><value name=\"SensorID\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">2</field></shadow></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"Jw*5#gXrBmZOh38I3nqt\">紅外線IR3</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"sensor_readIR2\"><value name=\"SensorID\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">3</field></shadow></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"b],5rysk1-X{_h.%t.#8\">紅外線IR4</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"sensor_readIR2\"><value name=\"SensorID\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">4</field></shadow></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"/XBBo+}cltT28L%VnATN\">紅外線IR5</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"sensor_readIR2\"><value name=\"SensorID\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"4\" precision=\"0\"></mutation><field name=\"SLIDER\">5</field></shadow></value></block></value></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"509\" y=\"634\"><mutation name=\"判斷左普左彎\" functionid=\"xXz+-W0Z!2J?b7wrQk4q\"></mutation><field name=\"function_name\">判斷左普左彎</field><comment pinned=\"false\" h=\"80\" w=\"160\">偵測十字路口或T字路口</comment><statement name=\"STACK\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"qK|[aR#,=G%z!9(?rbhx\">紅外線IR1</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1000</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"`N34KA-DK3c.|a!):Wz:\">右邊紅外線狀態</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"8g;rxVKmdID^*}zkstji\">左邊紅外線狀態</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"L+`fkAF9r9s9h}-=/#7p\">中間紅外線狀態</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Fj?ln2!k)eDz5_4$fYJ4\">路口</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">左普</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"a%^:I=.%QgtsoX;|cx)c\">路口型態</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">3</field></shadow></value></block></next></block></statement><statement name=\"ELSE\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Fj?ln2!k)eDz5_4$fYJ4\">路口</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">左彎</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"a%^:I=.%QgtsoX;|cx)c\">路口型態</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"bwt$D7.oL(/do:4Fiy5i\">路口判斷結束</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></statement></block></statement></block><block type=\"function_definition\" x=\"1738\" y=\"634\"><mutation name=\"判斷右普右彎\" functionid=\"Y$GCBkS1sh61h.Vw=7wh\"></mutation><field name=\"function_name\">判斷右普右彎</field><comment pinned=\"false\" h=\"80\" w=\"160\">偵測右轉或右彎</comment><statement name=\"STACK\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">OR</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"qK|[aR#,=G%z!9(?rbhx\">紅外線IR1</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1000</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"`N34KA-DK3c.|a!):Wz:\">右邊紅外線狀態</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"8g;rxVKmdID^*}zkstji\">左邊紅外線狀態</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"L+`fkAF9r9s9h}-=/#7p\">中間紅外線狀態</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Fj?ln2!k)eDz5_4$fYJ4\">路口</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">右普</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"a%^:I=.%QgtsoX;|cx)c\">路口型態</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">6</field></shadow></value></block></next></block></statement><statement name=\"ELSE\"><block type=\"variables_set\"><field name=\"VAR\" id=\"Fj?ln2!k)eDz5_4$fYJ4\">路口</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"text\"><field name=\"TEXT\">右彎</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"a%^:I=.%QgtsoX;|cx)c\">路口型態</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">4</field></shadow></value></block></next></block></statement><next><block type=\"variables_set\"><field name=\"VAR\" id=\"bwt$D7.oL(/do:4Fiy5i\">路口判斷結束</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow></value></block></next></block></statement></block></statement></block></xml>","main.ts":"let 標記線計數 = 0;\nconst 總標記線數量 = 14;\nlet 基礎速度 = 200;\nlet kp = 150;\nlet kd = 180;\nlet 紅外線IR1 = 0;\nlet 紅外線IR2 = 0;\nlet 紅外線IR4 = 0;\nlet 紅外線IR3 = 0;\nlet 紅外線IR5 = 0;\nlet Error_P_old = 0;\nlet Error_D = 0;\nlet Error_P = 0;\nlet PID_Val = 0;\nlet 線位置 = 0;\nlet 終點時間 = 0;\nlet 找到終點 = 0;\nlet 中間紅外線狀態 = 0;\nlet 左邊紅外線狀態 = 0;\nlet 右邊紅外線狀態 = 0;\nlet 路口 = \"\";\nlet 路口型態 = 0;\nlet 路口判斷結束 = 0;\n\n// 設定PID控制器\nfunction 設定PID控制器(基礎速度: number, kp: number, kd: number) {\n    線位置 = BitRacer.readLine()\n    Error_P = 0 - 線位置;\n    Error_D = Error_P - Error_P_old;\n    Error_P_old = Error_P;\n    PID_Val = Error_P * kp + Error_D * kd;\n    BitRacer.motorRun(BitRacer.Motors.M_R, Math.constrain(基礎速度 + PID_Val, -1000, 1000));\n    BitRacer.motorRun(BitRacer.Motors.M_L, Math.constrain(基礎速度 - PID_Val, -1000, 1000));\n}\n\n// 偵測標記線的函式\nfunction 判斷標記線() {\n    if ((紅外線IR1 > 1000)|| (紅外線IR5 > 1000)) {\n        basic.pause(50);\n        標記線計數 += 1;\n        //basic.showNumber(標記線計數); // 顯示當前標記線數量\n\n        if (標記線計數 >= 總標記線數量) {\n            // 到達最後一條標記線，停止動作\n            BitRacer.motorRun(BitRacer.Motors.All, 0);\n            //music.play(music.tonePlayable(988, music.beat(BeatFraction.Whole)), music.PlaybackMode.UntilDone);\n            //basic.showIcon(IconNames.No);\n        } else {\n            巡白線();\n        }\n    }\n}\n\n\n\n// 讀取紅外線感應器的數值\nfunction 讀取紅外線() {\n    紅外線IR1 = BitRacer.readIR2(1);\n    紅外線IR2 = BitRacer.readIR2(2);\n    紅外線IR3 = BitRacer.readIR2(3);\n    紅外線IR4 = BitRacer.readIR2(4);\n    紅外線IR5 = BitRacer.readIR2(5);\n}\n\n// 主程式，用來巡線並偵測終點及標記線\n// 主程式，用來巡線並偵測終點及標記線\nfunction 巡白線() {\n    while (標記線計數 < 總標記線數量) {\n        // 基礎速度和PID控制\n        設定PID控制器(基礎速度, kp, kd);\n        讀取紅外線();\n\n        // 如果 IR1 < 1000，就執行右轉\n        if (紅外線IR1 >1000) {\n            BitRacer.motorRun(BitRacer.Motors.M_R, 基礎速度 - 50); // 減速右側馬達\n            BitRacer.motorRun(BitRacer.Motors.M_L, 基礎速度 + 50); // 加速左側馬達\n            basic.pause(200); // 持續右轉的時間\n        }\n\n        判斷標記線(); // 檢查標記線\n        if (標記線計數 >= 總標記線數量) {\n            break;\n        }\n    }\n}\n\n// 按下 A 鍵後開始巡線\ninput.onButtonPressed(Button.A, function () {\n    music.play(music.tonePlayable(988, music.beat(BeatFraction.Whole)), music.PlaybackMode.UntilDone);\n    basic.pause(1000);\n    //找到終點 = 0;\n    標記線計數 = 0;\n    巡白線();\n\n    //music.play(music.tonePlayable(988, music.beat(BeatFraction.Whole)), music.PlaybackMode.UntilDone);\n    //basic.showIcon(IconNames.Square);\n    //basic.clearScreen();\n});","README.md":"","main.py":"標記線計數 = 0\n總標記線數量 = 10\n基礎速度 = 200\nkp = 150\nkd = 180\n紅外線IR1 = 0\n紅外線IR2 = 0\n紅外線IR4 = 0\n紅外線IR3 = 0\n紅外線IR5 = 0\nError_P_old = 0\nError_D = 0\nError_P = 0\nPID_Val = 0\n線位置 = 0\n終點時間 = 0\n找到終點 = 0\n中間紅外線狀態 = 0\n左邊紅外線狀態 = 0\n右邊紅外線狀態 = 0\n路口 = \"\"\n路口型態 = 0\n路口判斷結束 = 0\n# 設定PID控制器\ndef 設定PID控制器(基礎速度2: number, kp2: number, kd2: number):\n    global 線位置, Error_P, Error_D, Error_P_old, PID_Val\n    線位置 = BitRacer.read_line()\n    Error_P = 0 - 線位置\n    Error_D = Error_P - Error_P_old\n    Error_P_old = Error_P\n    PID_Val = Error_P * kp2 + Error_D * kd2\n    BitRacer.motor_run(BitRacer.Motors.M_R,\n        Math.constrain(基礎速度2 + PID_Val, -1000, 1000))\n    BitRacer.motor_run(BitRacer.Motors.M_L,\n        Math.constrain(基礎速度2 - PID_Val, -1000, 1000))\n# 偵測標記線的函式\ndef 判斷標記線():\n    global 標記線計數\n    if (紅外線IR5 > 1000):\n        basic.pause(50)\n        標記線計數 += 1\n        # basic.showNumber(標記線計數); // 顯示當前標記線數量\n        # music.play(music.tonePlayable(988, music.beat(BeatFraction.Whole)), music.PlaybackMode.UntilDone);\n        # basic.showIcon(IconNames.No);\n        if 標記線計數 >= 總標記線數量:\n            # 到達最後一條標記線，停止動作\n            BitRacer.motor_run(BitRacer.Motors.ALL, 0)\n        else:\n            巡白線()\n# 偵測十字路口或T字路口\ndef 判斷左普左彎():\n    global 路口, 路口型態, 路口判斷結束\n    if 紅外線IR1 < 1000 and 右邊紅外線狀態 == 0 and 左邊紅外線狀態 == 1:\n        if 中間紅外線狀態 == 1:\n            路口 = \"左普\"\n            路口型態 = 3\n        else:\n            路口 = \"左彎\"\n            路口型態 = 1\n        路口判斷結束 = 1\n# 偵測右轉或右彎\ndef 判斷右普右彎():\n    global 路口, 路口型態, 路口判斷結束\n    if (紅外線IR1 < 1000) or (右邊紅外線狀態 == 1 and 左邊紅外線狀態 == 0):\n        if 中間紅外線狀態 == 1:\n            路口 = \"右普\"\n            路口型態 = 6\n        else:\n            路口 = \"右彎\"\n            路口型態 = 4\n        路口判斷結束 = 1\n# 讀取紅外線感應器的數值\ndef 讀取紅外線():\n    global 紅外線IR1, 紅外線IR2, 紅外線IR3, 紅外線IR4, 紅外線IR5\n    紅外線IR1 = BitRacer.read_ir2(1)\n    紅外線IR2 = BitRacer.read_ir2(2)\n    紅外線IR3 = BitRacer.read_ir2(3)\n    紅外線IR4 = BitRacer.read_ir2(4)\n    紅外線IR5 = BitRacer.read_ir2(5)\n# 主程式，用來巡線並偵測終點及標記線\ndef 巡白線():\n    while (標記線計數 < 總標記線數量):\n        # 基礎速度和PID控制\n        設定PID控制器(基礎速度, kp, kd)\n        讀取紅外線()\n        判斷標記線()\n        # 檢查標記線\n        # 判斷終點();\n        判斷左普左彎()\n        判斷右普右彎()\n        if 標記線計數 >= 總標記線數量:\n            break\n# 按下 A 鍵後開始巡線\n# basic.clearScreen();\n\ndef on_button_pressed_a():\n    global 標記線計數\n    music.play(music.tone_playable(988, music.beat(BeatFraction.WHOLE)),\n        music.PlaybackMode.UNTIL_DONE)\n    basic.pause(1000)\n    # 找到終點 = 0;\n    標記線計數 = 0\n    巡白線()\n    # music.play(music.tonePlayable(988, music.beat(BeatFraction.Whole)), music.PlaybackMode.UntilDone);\n    # basic.showIcon(IconNames.Square);\n    basic.pause(1000)\ninput.on_button_pressed(Button.A, on_button_pressed_a)\n","pxt.json":"{\n    \"name\": \"比賽的範例檔案（51115123)\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"radio\": \"*\",\n        \"microphone\": \"*\",\n        \"BitRacer\": \"github:51135499/BitRacer#066fa557214aea79a82a79f73d2ddc5c665d3075\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"main.py\"\n    ],\n    \"targetVersions\": {\n        \"target\": \"6.0.19\",\n        \"pxt\": \"9.0.12\"\n    },\n    \"preferredEditor\": \"tsprj\"\n}\n"}}],"shares":[{"id":"23338-24184-67447-06698","timestamp":1736949378030}],"lastSaveTime":1736949714362}